<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Monty Mart</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
body{margin:0;font-family:Arial;background:#f2f2f2;}
header{background:#111;color:white;text-align:center;padding:15px;font-size:22px;}
.container{display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:15px;padding:15px;}
.card{background:white;padding:10px;border-radius:10px;text-align:center;box-shadow:0 4px 10px rgba(0,0,0,0.1);}
.card img{width:100%;height:140px;object-fit:cover;border-radius:8px;}
.price{font-weight:bold;margin:6px;}
.stock{font-size:14px;margin-bottom:5px;}
.btn{background:#25D366;color:white;padding:8px 12px;border:none;border-radius:6px;cursor:pointer;margin-top:5px;}
.infoBar{background:#e2f0ff;padding:6px;text-align:center;}
  .weight{
font-size:13px;
color:#555;
margin-bottom:4px;
}

</style>
</head>

<body>

<header>üõí My Hostel Store</header>
<div id="storeStatus" style="text-align:center;padding:6px;background:#d4edda;color:#155724;">STORE OPEN</div>
<div id="topItem" class="infoBar">Top Item: -</div>

<h2 style="text-align:center">Customer Details</h2>
<div style="text-align:center;margin-bottom:20px;">
<input id="custName" placeholder="Your Name"><br>
<input id="roomNo" placeholder="Room Number"><br>

<select id="hostel">
<option>Boys Hostel</option>
<option>Gate Pickup</option>
<option>Girls Hostel</option>
</select><br>

<select id="payment">
<option>UPI</option>
<option>Cash</option>
<option>Paytm</option>
</select><br>

<input id="utr" placeholder="UPI Ref No"><br>

<select id="mode">
<option value="delivery">Room Delivery</option>
<option value="pickup">Self Pickup</option>
</select><br>
</div>

<div class="container">
<div class="card"><img src="maggi.jpg"><h3>Maggi</h3>
<div class="weight">70g Pack</div>
<div class="price">‚Çπ20</div>
<div class="stock"></div><input type="number" id="qty1" value="1"><br><button class="btn" onclick="addToCart('Maggi',20,'qty1')">Add</button></div>
<div class="card"><img src="kurkure.jpg"><h3>Kurkure</h3><div class="weight">75g Pack</div><div class="price">‚Çπ20</div><div class="stock"></div><input type="number" id="qty2" value="1"><br><button class="btn" onclick="addToCart('Kurkure',20,'qty2')">Add</button></div>
<div class="card"><img src="bhujia.jpg"><h3>Bhujia</h3><div class="weight">1kg Pack</div><div class="price">‚Çπ300</div><div class="stock"></div><input type="number" id="qty3" value="1"><br><button class="btn" onclick="addToCart('Bhujia',300,'qty3')">Add</button></div>
<div class="card"><img src="ariel.jpg"><h3>Ariel</h3><div class="weight">1L Pack</div><div class="price">‚Çπ160</div><div class="stock"></div><input type="number" id="qty4" value="1"><br><button class="btn" onclick="addToCart('Ariel',160,'qty4')">Add</button></div>
</div>

<h2 style="text-align:center">üõí Cart</h2>
<div id="cart" style="text-align:center"></div>

<div style="text-align:center;margin:20px;">
<button class="btn" onclick="placeOrder()">Place Order on WhatsApp</button>
</div>

<div style="text-align:center;margin-top:30px;">
<button onclick="showAdmin()">Admin</button>
<div id="adminPanel" style="display:none;border:1px solid #ccc;padding:10px;margin-top:10px;">
<h3>Admin</h3>
<div id="earningsBox">Today Earnings: ‚Çπ0</div>
<div id="lowStockBox">Low Stock: None</div>
<div id="ordersList"></div>

Maggi <input id="sMaggi" type="number"><br>
Kurkure <input id="sKurkure" type="number"><br>
Bhujia <input id="sBhujia" type="number"><br>
Ariel <input id="sAriel" type="number"><br>

<button onclick="saveStock()">Save Stock</button>
  <button onclick="showReport()">Today Report</button>

<button onclick="resetStock()">Reset</button>
<button onclick="toggleStore()">Open/Close</button>
 

<hr>
<h3>Purchase Price (Profit)</h3>

Maggi Buy ‚Çπ <input id="bMaggi" type="number"><br>
Kurkure Buy ‚Çπ <input id="bKurkure" type="number"><br>
Bhujia Buy ‚Çπ <input id="bBhujia" type="number"><br>
Ariel Buy ‚Çπ <input id="bAriel" type="number"><br>

<button onclick="saveBuyPrice()">Save Buy Price</button>

<div id="profitBox">Today Profit: ‚Çπ0</div>

</div>
</div>

<!-- BILL -->
<div id="billBox" style="position:fixed;left:-9999px;top:0;opacity:0;background:white;padding:15px;font-family:monospace;width:280px;border:1px solid #000">

<h3 style="text-align:center;margin:0;">HOSTEL STORE</h3>
<hr>
<div id="billContent"></div>
<hr>
<div style="text-align:center">Thank You</div>
</div>

<script>
var phone="919983729301";
var cart=[];
var orderCounter=parseInt(localStorage.getItem("orderNo")||1001);
var stockData=JSON.parse(localStorage.getItem("storeStock"))||{Maggi:24,Kurkure:9,Bhujia:2,Ariel:1};

function updateStoreStatus(){
let closed=localStorage.getItem("storeClosed")==="true";
let bar=document.getElementById("storeStatus");
bar.innerText=closed?"STORE CLOSED":"STORE OPEN";
}
updateStoreStatus();

function updateStockDisplay(){
document.querySelectorAll(".card").forEach(card=>{
let name=card.querySelector("h3").innerText;
let stock=stockData[name]||0;
let btn=card.querySelector("button");
card.querySelector(".stock").innerText=stock>0?"In Stock: "+stock:"Out of Stock";
btn.disabled=stock<=0;
});
}
updateStockDisplay();

function addToCart(name,price,id){
  if(localStorage.getItem("storeClosed")==="true"){
alert("Store Closed");
return;
}

let q=parseInt(document.getElementById(id).value);
if(q<=0||isNaN(q))return alert("Enter valid quantity");
let already=0;
cart.forEach(i=>{if(i.name===name)already+=i.qty});
let available=stockData[name]-already;
if(q>available)return alert("Only "+available+" left");
let found=cart.find(i=>i.name===name);
if(found)found.qty+=q; else cart.push({name,price,qty:q});
showCart();
}

function showCart(){
let html="",t=0;
cart.forEach((i,x)=>{let s=i.price*i.qty;t+=s;html+=`${i.name} x${i.qty}=‚Çπ${s} <button onclick="removeItem(${x})">‚ùå</button><br>`});
html+="<b>Total ‚Çπ"+t+"</b>";
document.getElementById("cart").innerHTML=html;
}
function removeItem(i){cart.splice(i,1);showCart();}

function getDeliveryCharge(mode){
if(mode==="pickup")return 0;
let h=new Date().getHours();
return (h>=8&&h<19)?10:20;
}

async function generateBillImage(text){

/* 1 ‚Äî text set karo */
let clean=text
.replace(/\n/g,"<br>")
.replace(/üßæ/g,"")
.replace(/üÜî/g,"Order No:")
.replace(/üë§/g,"Name:")
.replace(/üè†/g,"Room:")
.replace(/üè¢/g,"Hostel:")
.replace(/üì¶/g,"Mode:")
.replace(/üöö/g,"Delivery:")
.replace(/üí∞/g,"Total:");

document.getElementById("billContent").innerHTML=clean;


/* 2 ‚Äî element visible banao */
let billBox=document.getElementById("billBox");
billBox.style.position="fixed";
billBox.style.top="50%";
billBox.style.left="50%";
billBox.style.transform="translate(-50%,-50%)";
billBox.style.opacity="1";

/* 3 ‚Äî render hone ka wait */
await new Promise(r=>setTimeout(r,400));

/* 4 ‚Äî screenshot */
let canvas=await html2canvas(billBox,{
backgroundColor:"#ffffff",
scale:2
});

/* 5 ‚Äî download */
let link=document.createElement("a");
link.download="bill.png";
link.href=canvas.toDataURL("image/png");
link.click();

/* 6 ‚Äî hide again */
billBox.style.opacity="0";
billBox.style.left="-9999px";
}

function placeOrder(){
  /* STORE CLOSED BLOCK */
if(localStorage.getItem("storeClosed")==="true"){
alert("Store is currently closed");
return;
}

if(cart.length==0)return alert("Cart empty");

let name=custName.value.trim();
let room=roomNo.value.trim();
let hostel=document.getElementById("hostel").value;
let pay=document.getElementById("payment").value;
let utr=document.getElementById("utr").value.trim();
let mode=document.getElementById("mode").value;

if(!/^[A-Za-z ]+$/.test(name))return alert("Invalid name");
if(!/^[0-9]+$/.test(room))return alert("Room must be number");
if(hostel==="Girls Hostel")return alert("Not available for girls hostel");
if(pay!=="Cash"&&!/^[0-9]{4,12}$/.test(utr))return alert("Invalid UPI ref");

let cancelCode="CANCEL "+orderCounter;
let total=0;

let msg=`HOSTEL STORE ORDER
Order No: ${orderCounter}
Cancel Code: ${cancelCode}

Name: ${name}
Room No: ${room}
Hostel: ${hostel}
Mode: ${mode}

ITEMS
`;

cart.forEach(i=>{
let s=i.price*i.qty;
total+=s;
msg+=`${i.name} x${i.qty} = ‚Çπ${s}\n`;
stockData[i.name]-=i.qty;
  /* SAVE SALES DATA */
let today=new Date().toLocaleDateString();
let sales=JSON.parse(localStorage.getItem("salesData")||"{}");

if(!sales[today]) sales[today]={items:{},total:0};

sales[today].items[i.name]=(sales[today].items[i.name]||0)+i.qty;
sales[today].total+=s;

localStorage.setItem("salesData",JSON.stringify(sales));

});

let d=getDeliveryCharge(mode);
total+=d;

if(mode==="pickup")msg+=`\nCollect From Room: 605`;

msg+=`\nDelivery: ‚Çπ${d}\nTotal Payable: ‚Çπ${total}\nTime: 10-15 min`;

generateBillImage(msg);
window.open(`https://api.whatsapp.com/send?phone=${phone}&text=${encodeURIComponent(msg)}`);

localStorage.setItem("storeStock",JSON.stringify(stockData));
localStorage.setItem("orderNo",++orderCounter);

cart=[];showCart();updateStockDisplay();
}

function showAdmin(){if(prompt("Password")==="@monty291"){adminPanel.style.display="block"}}
function saveStock(){stockData={Maggi:+sMaggi.value,Kurkure:+sKurkure.value,Bhujia:+sBhujia.value,Ariel:+sAriel.value};localStorage.setItem("storeStock",JSON.stringify(stockData));updateStockDisplay();}
function resetStock(){localStorage.removeItem("storeStock");location.reload();}
function toggleStore(){let c=localStorage.getItem("storeClosed")==="true";localStorage.setItem("storeClosed",!c);updateStoreStatus();}
function showReport(){

let sales=JSON.parse(localStorage.getItem("salesData")||"{}");
let text="üìä TODAY REPORT\n\n";

let today=new Date().toLocaleDateString();

if(!sales[today]){
alert("No sales today");
return;
}

for(let item in sales[today].items){
text+=item+" x "+sales[today].items[item]+"\n";
}

text+="\nTotal ‚Çπ"+sales[today].total;

alert(text);
}
  function monthlyReport(){

let sales=JSON.parse(localStorage.getItem("salesData")||"{}");
let month=new Date().getMonth();
let total=0;

for(let date in sales){
let d=new Date(date);
if(d.getMonth()==month) total+=sales[date].total;
}

alert("This Month Total ‚Çπ"+total);
}

</script>

</body>
</html>




















